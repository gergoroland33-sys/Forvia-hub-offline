<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Forvia Quality Analysis Pro</title>
<style>
:root {
--primary: #3b82f6; --bg: #0f172a; --card-bg: #1e293b; --card-border: #334155;
--text-main: #f1f5f9; --text-muted: #94a3b8; --error: #ef4444; --warning: #f59e0b;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text-main); margin: 0; padding: 20px; padding-bottom: 100px; }

.container { max-width: 1000px; margin: 0 auto; }

header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--card-border); }
.logo h1 { margin: 0; font-size: 1.4rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
.logo span { color: var(--primary); }
.file-date { font-size: 0.9rem; color: var(--text-muted); margin-top: 5px; }

.upload-zone {
background: rgba(30, 41, 59, 0.5); border: 2px dashed var(--card-border);
padding: 30px; text-align: center; border-radius: 15px; margin-bottom: 25px; cursor: pointer; transition: 0.3s;
}
.upload-zone:hover { border-color: var(--primary); background: rgba(59, 130, 246, 0.1); }

.filter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--card-border); }
.filter-group label { display: block; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 5px; color: var(--text-muted); font-weight: bold; }
select { width: 100%; background: var(--bg); color: white; border: 1px solid var(--card-border); padding: 10px; border-radius: 8px; outline: none; }

.stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
.stat-card { background: var(--card-bg); padding: 20px; border-radius: 12px; border-left: 5px solid var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
.stat-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); font-weight: bold; }
.stat-value { font-size: 1.8rem; font-weight: 800; display: block; margin-top: 5px; }

.top-highlights { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
.high-card { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); padding: 15px; border-radius: 12px; }
.high-card small { font-size: 0.7rem; color: var(--error); font-weight: 800; text-transform: uppercase; }
.high-card div { font-weight: 700; font-size: 1rem; margin-top: 5px; }

.analysis-card { background: var(--card-bg); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--card-border); }
h3 { font-size: 1rem; margin: 0 0 15px 0; text-transform: uppercase; letter-spacing: 1px; font-weight: 800; }

table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
th { text-align: left; color: var(--text-muted); padding: 12px; border-bottom: 1px solid var(--card-border); font-size: 0.75rem; text-transform: uppercase; }
td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
.rank { font-weight: 800; color: var(--primary); }
.badge { background: #0f172a; padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; border: 1px solid var(--card-border); }

@media (max-width: 600px) { .top-highlights { grid-template-columns: 1fr; } }
@media print {
.upload-zone, button, .filter-grid { display: none !important; }
body { background: white; color: black; padding: 0; }
.analysis-card, .stat-card { border: 1px solid #ccc; background: white !important; color: black !important; box-shadow: none; }
.stat-value, h1, span { color: black !important; }
}
</style>
</head>
<body>

<div class="container">
<header>
<div class="logo">
<h1>FORVIA <span>QUALITY</span></h1>
<div id="fileDisplay" class="file-date">Töltsön be egy fájlt az elemzéshez</div>
</div>
<button onclick="window.print()" style="padding:10px 20px; background:var(--primary); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:700;">NYOMTATÁS / PDF</button>
</header>

<div class="upload-zone" onclick="document.getElementById('fileInput').click()">
<div style="font-size:1.2rem; font-weight:bold; margin-bottom:5px;">Kattintson a CSV fájl kiválasztásához</div>
<div style="font-size:0.8rem; color:#94a3b8;">(Támogatott: pontosvesszővel vagy vesszővel tagolt .csv)</div>
<input type="file" id="fileInput" accept=".csv,.txt" style="display:none">
</div>

<div class="filter-grid">
<div class="filter-group">
<label>Gépsor (A)</label>
<select id="filterGepsorA" onchange="updateView()"><option value="mind">Mind</option></select>
</div>
<div class="filter-group">
<label>Gép Megnevezés</label>
<select id="filterGepsor" onchange="updateView()"><option value="mind">Mind</option></select>
</div>
<div class="filter-group">
<label>Top lista</label>
<select id="topLimit" onchange="updateView()">
<option value="5">Top 5</option>
<option value="10" selected>Top 10</option>
<option value="20">Top 20</option>
</select>
</div>
</div>

<div class="stats-row">
<div class="stat-card">
<span class="stat-label">Összes Beültetés</span>
<span class="stat-value" id="totalBeult">0</span>
</div>
<div class="stat-card" style="border-left-color:var(--error);">
<span class="stat-label">Felvételi Hiba</span>
<span class="stat-value" id="totalFelv" style="color:var(--error)">0</span>
</div>
<div class="stat-card" style="border-left-color:var(--warning);">
<span class="stat-label">Kamera Hiba</span>
<span class="stat-value" id="totalKam" style="color:var(--warning)">0</span>
</div>
</div>

<div class="top-highlights">
<div class="high-card">
<small>Kritikus Cikkszám (Felvétel)</small>
<div id="worstFelv">-</div>
</div>
<div class="high-card">
<small>Kritikus Cikkszám (Kamera)</small>
<div id="worstKam">-</div>
</div>
</div>

<div class="analysis-card">
<h3 style="color:var(--primary)">Top Felvételi Hibák Elemzése</h3>
<table id="tableFelv">
<thead><tr><th>#</th><th>Cikkszám</th><th>Hiba db</th><th>Arány</th><th>Gépadat</th></tr></thead>
<tbody></tbody>
</table>
</div>

<div class="analysis-card">
<h3 style="color:var(--warning)">Top Kamera Hibák Elemzése</h3>
<table id="tableKam">
<thead><tr><th>#</th><th>Cikkszám</th><th>Hiba db</th><th>Arány</th><th>Gépadat</th></tr></thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
let allData = [];

document.getElementById('fileInput').addEventListener('change', function(e) {
const file = e.target.files[0];
if (!file) return;

// Fájlnév kiírása
document.getElementById('fileDisplay').innerText = `Betöltve: ${file.name}`;

const reader = new FileReader();
reader.onload = (ev) => {
const content = ev.target.result;
const lines = content.split('\n').map(x => x.trim()).filter(x => x);

if (lines.length < 2) {
alert("A fájl üres vagy hibás!");
return;
}

// Automatikus CSV elválasztó felismerés (; vagy ,)
let separator = ';';
if (lines[0].indexOf(';') === -1 && lines[0].indexOf(',') > -1) {
separator = ',';
}

// Adatfeldolgozás
allData = lines.slice(1).map(line => {
const c = line.split(separator);
if (c.length < 3) return null;
return {
gA: c[0] ? c[0].trim() : "Egyéb", // Gépsor
g: c[1] ? c[1].trim() : "Egyéb", // Gép
cikk: c[2] ? c[2].trim() : "Ismeretlen", // Cikkszám
b: parseInt(c[3]) || 0, // Beültetés
f: parseInt(c[4]) || 0, // Felvételi Hiba
k: parseInt(c[5]) || 0 // Kamera Hiba
};
}).filter(item => item !== null);

populateFilters();
updateView();
};
reader.readAsText(file);
});

function populateFilters() {
const gA = [...new Set(allData.map(d => d.gA))].sort();
const g = [...new Set(allData.map(d => d.g))].sort();

fillSelect('filterGepsorA', gA);
fillSelect('filterGepsor', g);
}

function fillSelect(id, items) {
const s = document.getElementById(id);
s.innerHTML = '<option value="mind">Mind</option>';
items.forEach(i => s.innerHTML += `<option value="${i}">${i}</option>`);
}

function updateView() {
if (!allData.length) return;

const fGA = document.getElementById('filterGepsorA').value;
const fG = document.getElementById('filterGepsor').value;
const limit = parseInt(document.getElementById('topLimit').value);

// Szűrés
const filtered = allData.filter(d =>
(fGA === 'mind' || d.gA === fGA) &&
(fG === 'mind' || d.g === fG)
);

// Statisztika számolás
let stats = { beult: 0, felv: 0, kam: 0, dF: {}, dK: {}, dInfo: {} };

filtered.forEach(d => {
stats.beult += d.b;
stats.felv += d.f;
stats.kam += d.k;

if (d.f > 0) stats.dF[d.cikk] = (stats.dF[d.cikk] || 0) + d.f;
if (d.k > 0) stats.dK[d.cikk] = (stats.dK[d.cikk] || 0) + d.k;

stats.dInfo[d.cikk] = `${d.g} / ${d.gA}`;
});

// Kártyák frissítése
document.getElementById('totalBeult').innerText = stats.beult.toLocaleString();
document.getElementById('totalFelv').innerText = stats.felv.toLocaleString();
document.getElementById('totalKam').innerText = stats.kam.toLocaleString();

// Táblázatok renderelése
renderTable('tableFelv', stats.dF, stats.dInfo, stats.felv, limit, 'worstFelv');
renderTable('tableKam', stats.dK, stats.dInfo, stats.kam, limit, 'worstKam');
}

function renderTable(tableId, dataDict, infoDict, totalError, limit, worstId) {
const tbody = document.getElementById(tableId).querySelector('tbody');
tbody.innerHTML = "";

const sorted = Object.entries(dataDict).sort((a, b) => b[1] - a[1]);

// Legrosszabb kiírása
if (sorted.length > 0) {
document.getElementById(worstId).innerText = `${sorted[0][0]} (${sorted[0][1]} db)`;
} else {
document.getElementById(worstId).innerText = "-";
}

sorted.slice(0, limit).forEach((item, idx) => {
const percent = totalError > 0 ? ((item[1] / totalError) * 100).toFixed(1) : 0;
const row = `
<tr>
<td class="rank">${idx + 1}.</td>
<td><strong>${item[0]}</strong></td>
<td>${item[1].toLocaleString()}</td>
<td>${percent}%</td>
<td><span class="badge">${infoDict[item[0]] || '-'}</span></td>
</tr>
`;
tbody.innerHTML += row;
});

if (sorted.length === 0) {
tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;">Nincs megjeleníthető adat</td></tr>';
}
}
</script>

</body>
</html>
